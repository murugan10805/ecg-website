<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart ECG Monitoring System</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0b1220;
    color: white;
}

header {
    background: #0f1b35;
    padding: 15px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
}

.container {
    width: 1000px;
    margin: 20px auto;
}

.box {
    background: #121c35;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
}

input {
    padding: 10px;
    width: 250px;
    border-radius: 5px;
    border: none;
    margin-right: 10px;
}

button {
    padding: 10px 20px;
    background: #1f8ef1;
    border: none;
    border-radius: 5px;
    color: white;
    cursor: pointer;
}

button:hover {
    background: #0d6efd;
}

.hidden {
    display: none;
}

canvas {
    background: black;
    border-radius: 8px;
}
</style>
</head>

<body>

<header>Smart ECG Monitoring System - Raspberry Pi 5</header>

<div class="container">

    <!-- Search -->
    <div class="box">
        <h3>Search Patient</h3>
        <input type="text" id="name" placeholder="Patient Name">
        <input type="text" id="phone" placeholder="Phone Number">
        <button onclick="searchPatient()">Search</button>
    </div>

    <!-- Patient -->
    <div class="box hidden" id="patientBox">
        <h3>Patient Details</h3>
        <p>Name: <span id="pname"></span></p>
        <p>Phone: <span id="pphone"></span></p>
        <p>Age: <span id="page"></span></p>
        <p>Gender: <span id="pgender"></span></p>
    </div>

    <!-- ECG -->
    <div class="box hidden" id="ecgBox">
        <h3>Live ECG Monitor</h3>
        <canvas id="ecgCanvas" width="950" height="300"></canvas>
    </div>

</div>

<script>
const patients = [
    { name: "Murugan", phone: "9150387820", age: 21, gender: "Male" },
    { name: "Jawahar", phone: "7604985592", age: 21, gender: "Male" },
    { name: "Mathumitha", phone: "8610275836", age: 21, gender: "Female" }
];

function searchPatient() {
    const name = document.getElementById("name").value.toLowerCase();
    const phone = document.getElementById("phone").value;

    let found = patients.find(p =>
        p.name.toLowerCase().includes(name) || p.phone.includes(phone)
    );

    if (!found) {
        alert("Patient not found");
        return;
    }

    document.getElementById("patientBox").classList.remove("hidden");
    document.getElementById("ecgBox").classList.remove("hidden");

    pname.innerText = found.name;
    pphone.innerText = found.phone;
    page.innerText = found.age;
    pgender.innerText = found.gender;

    startECG();
}


/* ================= ECG MONITOR ================= */

const canvas = document.getElementById("ecgCanvas");
const ctx = canvas.getContext("2d");

let x = 0;
let yBase = canvas.height / 2;
let speed = 2;

function drawGrid() {
    ctx.strokeStyle = "#003300";
    ctx.lineWidth = 1;

    for (let i = 0; i < canvas.width; i += 40) {
        ctx.beginPath();
        ctx.moveTo(i, 0);
        ctx.lineTo(i, canvas.height);
        ctx.stroke();
    }

    for (let i = 0; i < canvas.height; i += 40) {
        ctx.beginPath();
        ctx.moveTo(0, i);
        ctx.lineTo(canvas.width, i);
        ctx.stroke();
    }
}

let t = 0;

function ecgWave(t) {
    return (
        0.6 * Math.exp(-Math.pow(t - 0.8, 2) / 0.02) -
        1.5 * Math.exp(-Math.pow(t - 1.6, 2) / 0.002) +
        4.0 * Math.exp(-Math.pow(t - 1.7, 2) / 0.001) -
        1.0 * Math.exp(-Math.pow(t - 1.85, 2) / 0.002) +
        1.2 * Math.exp(-Math.pow(t - 3.0, 2) / 0.04)
    );
}

function startECG() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawGrid();
    x = 0;
    t = 0;
    requestAnimationFrame(drawECG);
}

function drawECG() {
    ctx.fillStyle = "rgba(0,0,0,0.1)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    let y = yBase - ecgWave(t) * 50;

    ctx.strokeStyle = "#00ff00";
    ctx.lineWidth = 2;

    ctx.beginPath();
    ctx.moveTo(x, yBase);
    ctx.lineTo(x + speed, y);
    ctx.stroke();

    x += speed;
    t += 0.05;

    if (x >= canvas.width) {
        x = 0;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGrid();
    }

    requestAnimationFrame(drawECG);
}
</script>

</body>
</html>
